var AutoFill;!function(t){AutoFill=function(e,s){return this.CLASS&&"AutoFill"==this.CLASS?t.fn.dataTableExt.fnVersionCheck("1.7.0")?(this.s={filler:{height:0,width:0},border:{width:2},drag:{startX:-1,startY:-1,startTd:null,endTd:null,dragging:!1},screen:{interval:null,y:0,height:0,scrollTop:0},scroller:{top:0,bottom:0},columns:[]},this.dom={table:null,filler:null,borderTop:null,borderRight:null,borderBottom:null,borderLeft:null,currentTarget:null},this.fnSettings=function(){return this.s},this._fnInit(e,s),this):(alert("Warning: AutoFill requires DataTables 1.7 or greater - www.datatables.net/download"),void 0):(alert("Warning: AutoFill must be initialised with the keyword 'new'"),void 0)},AutoFill.prototype={_fnInit:function(e,s){var o,l,i=this;for(this.s.dt=e.fnSettings(),this.dom.table=this.s.dt.nTable,o=0,l=this.s.dt.aoColumns.length;l>o;o++)this._fnAddColumn(o);"undefined"!=typeof s&&"undefined"!=typeof s.aoColumnDefs&&this._fnColumnDefs(s.aoColumnDefs),"undefined"!=typeof s&&"undefined"!=typeof s.aoColumns&&this._fnColumnsAll(s.aoColumns);var r=document.createElement("div");r.className="AutoFill_filler",document.body.appendChild(r),this.dom.filler=r,r.style.display="block",this.s.filler.height=t(r).height(),this.s.filler.width=t(r).width(),r.style.display="none";var n,d=document.body;""!==i.s.dt.oScroll.sY&&(i.s.dt.nTable.parentNode.style.position="relative",d=i.s.dt.nTable.parentNode),n=document.createElement("div"),n.className="AutoFill_border",d.appendChild(n),this.dom.borderTop=n,n=document.createElement("div"),n.className="AutoFill_border",d.appendChild(n),this.dom.borderRight=n,n=document.createElement("div"),n.className="AutoFill_border",d.appendChild(n),this.dom.borderBottom=n,n=document.createElement("div"),n.className="AutoFill_border",d.appendChild(n),this.dom.borderLeft=n,t(r).mousedown(function(t){return this.onselectstart=function(){return!1},i._fnFillerDragStart.call(i,t),!1}),t("tbody>tr>td",this.dom.table).live("mouseover mouseout",function(t){i._fnFillerDisplay.call(i,t)})},_fnColumnDefs:function(t){var e,s,o,l,i,r;for(e=t.length-1;e>=0;e--)for(r=t[e].aTargets,s=0,l=r.length;l>s;s++)if("number"==typeof r[s]&&r[s]>=0)this._fnColumnOptions(r[s],t[e]);else if("number"==typeof r[s]&&r[s]<0)this._fnColumnOptions(this.s.dt.aoColumns.length+r[s],t[e]);else if("string"==typeof r[s])for(o=0,i=this.s.dt.aoColumns.length;i>o;o++)("_all"==r[s]||-1!=this.s.dt.aoColumns[o].nTh.className.indexOf(r[s]))&&this._fnColumnOptions(o,t[e])},_fnColumnsAll:function(t){for(var e=0,s=this.s.dt.aoColumns.length;s>e;e++)this._fnColumnOptions(e,t[e])},_fnAddColumn:function(t){this.s.columns[t]={enable:!0,read:this._fnReadCell,write:this._fnWriteCell,step:this._fnStep,complete:null}},_fnColumnOptions:function(t,e){"undefined"!=typeof e.bEnable&&(this.s.columns[t].enable=e.bEnable),"undefined"!=typeof e.fnRead&&(this.s.columns[t].read=e.fnRead),"undefined"!=typeof e.fnWrite&&(this.s.columns[t].write=e.fnWrite),"undefined"!=typeof e.fnStep&&(this.s.columns[t].step=e.fnStep),"undefined"!=typeof e.fnCallback&&(this.s.columns[t].complete=e.fnCallback)},_fnTargetCoords:function(e){var s=t(e).parents("tr")[0];return{x:t("td",s).index(e),y:t("tr",s.parentNode).index(s)}},_fnUpdateBorder:function(e,s){var o,l=this.s.border.width,i=t(e).offset(),r=t(s).offset(),n=i.left-l,d=r.left+t(s).outerWidth(),a=i.top-l,h=r.top+t(s).outerHeight(),f=r.left+t(s).outerWidth()-i.left+2*l,u=r.top+t(s).outerHeight()-i.top+2*l;if(""!==this.s.dt.oScroll.sY){var p=t(this.s.dt.nTable.parentNode).offset(),c=t(this.s.dt.nTable.parentNode).scrollTop(),m=t(this.s.dt.nTable.parentNode).scrollLeft();n-=p.left-m,d-=p.left-m,a-=p.top-c,h-=p.top-c}o=this.dom.borderTop.style,o.top=a+"px",o.left=n+"px",o.height=this.s.border.width+"px",o.width=f+"px",o=this.dom.borderBottom.style,o.top=h+"px",o.left=n+"px",o.height=this.s.border.width+"px",o.width=f+"px",o=this.dom.borderLeft.style,o.top=a+"px",o.left=n+"px",o.height=u+"px",o.width=this.s.border.width+"px",o=this.dom.borderRight.style,o.top=a+"px",o.left=d+"px",o.height=u+"px",o.width=this.s.border.width+"px"},_fnFillerDragStart:function(e){var s=this,o=this.dom.currentTarget;this.s.drag.dragging=!0,s.dom.borderTop.style.display="block",s.dom.borderRight.style.display="block",s.dom.borderBottom.style.display="block",s.dom.borderLeft.style.display="block";var l=this._fnTargetCoords(o);this.s.drag.startX=l.x,this.s.drag.startY=l.y,this.s.drag.startTd=o,this.s.drag.endTd=o,this._fnUpdateBorder(o,o),t(document).bind("mousemove.AutoFill",function(t){s._fnFillerDragMove.call(s,t)}),t(document).bind("mouseup.AutoFill",function(t){s._fnFillerFinish.call(s,t)}),this.s.screen.y=e.pageY,this.s.screen.height=t(window).height(),this.s.screen.scrollTop=t(document).scrollTop(),""!==this.s.dt.oScroll.sY&&(this.s.scroller.top=t(this.s.dt.nTable.parentNode).offset().top,this.s.scroller.bottom=this.s.scroller.top+t(this.s.dt.nTable.parentNode).height()),this.s.screen.interval=setInterval(function(){var e=t(document).scrollTop(),o=e-s.s.screen.scrollTop;s.s.screen.y+=o,s.s.screen.height-s.s.screen.y+e<50?t("html, body").animate({scrollTop:e+50},240,"linear"):s.s.screen.y-e<50&&t("html, body").animate({scrollTop:e-50},240,"linear"),""!==s.s.dt.oScroll.sY&&(s.s.screen.y>s.s.scroller.bottom-50?t(s.s.dt.nTable.parentNode).animate({scrollTop:t(s.s.dt.nTable.parentNode).scrollTop()+50},240,"linear"):s.s.screen.y<s.s.scroller.top+50&&t(s.s.dt.nTable.parentNode).animate({scrollTop:t(s.s.dt.nTable.parentNode).scrollTop()-50},240,"linear"))},250)},_fnFillerDragMove:function(e){if(e.target&&"TD"==e.target.nodeName.toUpperCase()&&e.target!=this.s.drag.endTd){var s=this._fnTargetCoords(e.target);if(s.x!=this.s.drag.startX&&(e.target=t("tbody>tr:eq("+s.y+")>td:eq("+this.s.drag.startX+")",this.dom.table)[0],s=this._fnTargetCoords(e.target)),s.x==this.s.drag.startX){var o=this.s.drag;o.endTd=e.target,s.y>=this.s.drag.startY?this._fnUpdateBorder(o.startTd,o.endTd):this._fnUpdateBorder(o.endTd,o.startTd),this._fnFillerPosition(e.target)}}this.s.screen.y=e.pageY,this.s.screen.scrollTop=t(document).scrollTop(),""!==this.s.dt.oScroll.sY&&(this.s.scroller.scrollTop=t(this.s.dt.nTable.parentNode).scrollTop(),this.s.scroller.top=t(this.s.dt.nTable.parentNode).offset().top,this.s.scroller.bottom=this.s.scroller.top+t(this.s.dt.nTable.parentNode).height())},_fnFillerFinish:function(){t(document).unbind("mousemove.AutoFill"),t(document).unbind("mouseup.AutoFill"),this.dom.borderTop.style.display="none",this.dom.borderRight.style.display="none",this.dom.borderBottom.style.display="none",this.dom.borderLeft.style.display="none",this.s.drag.dragging=!1,clearInterval(this.s.screen.interval);var e,s=this._fnTargetCoords(this.s.drag.startTd),o=this._fnTargetCoords(this.s.drag.endTd),l=[];if(s.y<=o.y)for(e=!0,i=s.y;i<=o.y;i++)l.push(t("tbody>tr:eq("+i+")>td:eq("+s.x+")",this.dom.table)[0]);else for(e=!1,i=s.y;i>=o.y;i--)l.push(t("tbody>tr:eq("+i+")>td:eq("+s.x+")",this.dom.table)[0]);var r=s.x,n=!1,d=[],a=this.s.columns[r].read.call(this,this.s.drag.startTd),h=this._fnPrep(a);for(i=0,iLen=l.length;iLen>i;i++){i==iLen-1&&(n=!0);var f=this.s.columns[r].read.call(this,l[i]),u=this.s.columns[r].step.call(this,l[i],h,i,e,"SPRYMEDIA_AUTOFILL_STEPPER");this.s.columns[r].write.call(this,l[i],u,n),d.push({td:l[i],newValue:u,oldValue:f})}null!==this.s.columns[r].complete&&this.s.columns[r].complete.call(this,d)},_fnPrep:function(t){var e=t.match(/[\d\.]+/g);if(!e||0===e.length)return{iStart:0,sStr:t,sPostFix:""};var s=e[e.length-1],o=parseInt(s,10),l=new RegExp("^(.*)"+s+"(.*?)$"),i=s.match(/\./)?"."+s.split(".")[1]:"";return{iStart:o,sStr:t.replace(l,"$1SPRYMEDIA_AUTOFILL_STEPPER$2"),sPostFix:i}},_fnStep:function(t,e,s,o,l){var i=o?e.iStart+s:e.iStart-s;return isNaN(i)&&(i=""),e.sStr.replace(l,i+e.sPostFix)},_fnReadCell:function(e){var s=t("input",e);return s.length>0?t(s).val():(s=t("select",e),s.length>0?t(s).val():e.innerHTML)},_fnWriteCell:function(e,s,o){var l=t("input",e);if(l.length>0)return t(l).val(s),void 0;if(l=t("select",e),l.length>0)return t(l).val(s),void 0;var i=this.s.dt.oInstance.fnGetPosition(e);this.s.dt.oInstance.fnUpdate(s,i[0],i[2],o)},_fnFillerDisplay:function(e){if(!this.s.drag.dragging){var s="td"==e.target.nodeName.toLowerCase()?e.target:t(e.target).parents("td")[0],o=this._fnTargetCoords(s).x;if(this.s.columns[o].enable){var l=this.dom.filler;"mouseover"==e.type?(this.dom.currentTarget=s,this._fnFillerPosition(s),l.style.display="block"):e.relatedTarget&&e.relatedTarget.className.match(/AutoFill/)||(l.style.display="none")}}},_fnFillerPosition:function(e){var s=t(e).offset(),o=this.dom.filler;o.style.top=s.top-this.s.filler.height/2-1+t(e).outerHeight()+"px",o.style.left=s.left-this.s.filler.width/2-1+t(e).outerWidth()+"px"}},AutoFill.prototype.CLASS="AutoFill",AutoFill.VERSION="1.1.2",AutoFill.prototype.VERSION=AutoFill.VERSION}(jQuery);