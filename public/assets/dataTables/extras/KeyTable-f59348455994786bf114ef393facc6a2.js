function KeyTable(e){function t(e){return function(t,n,r){if(null!==t&&"number"!=typeof t||null!==n&&"number"!=typeof n||"function"!=typeof r)if("object"==typeof t&&"function"==typeof n){var l=p(t);o(e,l[0],l[1],n)}else alert("Unhandable event type was added: x"+t+"  y:"+n+"  z:"+r);else o(e,t,n,r)}}function n(e){return function(t,n,o){if(null!==t&&"number"!=typeof arguments[0]||null!==n&&"number"!=typeof arguments[1])if("object"==typeof arguments[0]){var l=p(t);"function"==typeof arguments[1]?r(e,l[0],l[1],n):r(e,l[0],l[1])}else alert("Unhandable event type was removed: x"+t+"  y:"+n+"  z:"+o);else"function"==typeof arguments[2]?r(e,t,n,o):r(e,t,n)}}function o(e,t,n,o){_[e].push({x:t,y:n,fn:o})}function r(e,t,n,o){for(var r=0,l=0,f=_[e].length;f-r>l;l++)if("undefined"!=typeof o)_[e][l-r].x==t&&_[e][l-r].y==n&&_[e][l-r].fn==o&&(_[e].splice(l-r,1),r++);else if(_[e][l-r].x==t&&_[e][l-r].y==n)return _[e].splice(l,1),1;return r}function l(e,t,n){for(var o=0,r=_[e],l=0;l<r.length;l++)(r[l].x==t&&r[l].y==n||null===r[l].x&&r[l].y==n||r[l].x==t&&null===r[l].y||null===r[l].x&&null===r[l].y)&&(r[l].fn(y(t,n),t,n),o++);return o}function f(e,t){if(N!=e){"undefined"==typeof t&&(t=!0),null!==N&&a(N),jQuery(e).addClass(Q),jQuery(e).parent().addClass(Q);var n;if(k){n=k.fnSettings();for(var o=h(e)[1],r=E;o>=n.fnDisplayEnd();)n._iDisplayLength>=0?n._iDisplayStart+n._iDisplayLength<n.fnRecordsDisplay()&&(n._iDisplayStart+=n._iDisplayLength):n._iDisplayStart=0,k.oApi._fnCalculateEnd(n);for(;o<n._iDisplayStart;)n._iDisplayStart=n._iDisplayLength>=0?n._iDisplayStart-n._iDisplayLength:0,n._iDisplayStart<0&&(n._iDisplayStart=0),k.oApi._fnCalculateEnd(n);k.oApi._fnDraw(n),E=r}var f=p(e);N=e,j=f[0],L=f[1];var i,u,s,d,y,v,T;if(t&&(i=document.documentElement.clientHeight,u=document.documentElement.clientWidth,s=document.body.scrollTop||document.documentElement.scrollTop,d=document.body.scrollLeft||document.documentElement.scrollLeft,y=e.offsetHeight,v=e.offsetWidth,T=g(e),!k||"undefined"==typeof n.oScroll||""===n.oScroll.sX&&""===n.oScroll.sY||(T[1]-=$(n.nTable.parentNode).scrollTop(),T[0]-=$(n.nTable.parentNode).scrollLeft()),T[1]+y>s+i?m(T[1]+y-i):T[1]<s&&m(T[1]),T[0]+v>d+u?b(T[0]+v-u):T[0]<d&&b(T[0])),k&&"undefined"!=typeof n.oScroll&&(""!==n.oScroll.sX||""!==n.oScroll.sY)){var D=n.nTable.parentNode;i=D.clientHeight,u=D.clientWidth,s=D.scrollTop,d=D.scrollLeft,y=e.offsetHeight,v=e.offsetWidth,e.offsetTop+y>i+s?D.scrollTop=e.offsetTop+y-i:e.offsetTop<s&&(D.scrollTop=e.offsetTop),e.offsetLeft+v>u+d?D.scrollLeft=e.offsetLeft+v-u:e.offsetLeft<d&&(D.scrollLeft=e.offsetLeft)}c(),l("focus",j,L)}}function i(){a(N),j=null,L=null,N=null,d()}function a(e){jQuery(e).removeClass(Q),jQuery(e).parent().removeClass(Q),l("blur",j,L)}function u(){for(var e=this;"TD"!=e.nodeName;)e=e.parentNode;f(e),c()}function s(e){if(x.block||!E)return!0;if(e.metaKey||e.altKey||e.ctrlKey)return!0;var t,n,o,r=S.getElementsByTagName("tr")[0].getElementsByTagName("td").length;if(k){var a=k.fnSettings();o=a.aiDisplay.length;var u=h(N);if(null===u)return;j=u[0],L=u[1]}else o=S.getElementsByTagName("tr").length;var s=9==e.keyCode&&e.shiftKey?-1:e.keyCode;switch(s){case 13:return e.preventDefault(),e.stopPropagation(),l("action",j,L),!0;case 27:if(!l("esc",j,L))return i(),void 0;t=j,n=L;break;case-1:case 37:if(j>0)t=j-1,n=L;else{if(!(L>0))return-1==s&&T?(C=!0,D.focus(),setTimeout(function(){C=!1},0),E=!1,i(),!0):!1;t=r-1,n=L-1}break;case 38:if(!(L>0))return!1;t=j,n=L-1;break;case 9:case 39:if(r-1>j)t=j+1,n=L;else{if(!(o-1>L))return 9==s&&T?(C=!0,D.focus(),setTimeout(function(){C=!1},0),E=!1,i(),!0):!1;t=0,n=L+1}break;case 40:if(!(o-1>L))return!1;t=j,n=L+1;break;default:return!0}return f(y(t,n)),!1}function c(){E||(E=!0)}function d(){E=!1}function y(e,t){if(k){var n=k.fnSettings();return"undefined"!=typeof n.aoData[n.aiDisplay[t]]?n.aoData[n.aiDisplay[t]].nTr.getElementsByTagName("td")[e]:null}return jQuery("tr:eq("+t+")>td:eq("+e+")",S)[0]}function p(e){if(k){var t=k.fnSettings();return[jQuery("td",e.parentNode).index(e),jQuery("tr",e.parentNode.parentNode).index(e.parentNode)+t._iDisplayStart]}return[jQuery("td",e.parentNode).index(e),jQuery("tr",e.parentNode.parentNode).index(e.parentNode)]}function m(e){document.documentElement.scrollTop=e,document.body.scrollTop=e}function b(e){document.documentElement.scrollLeft=e,document.body.scrollLeft=e}function g(e){var t=0,n=0;if(e.offsetParent)for(t=e.offsetLeft,n=e.offsetTop,e=e.offsetParent;e;)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return[t,n]}function h(e){for(var t=k.fnSettings(),n=0,o=t.aiDisplay.length;o>n;n++)for(var r=t.aoData[t.aiDisplay[n]].nTr,l=r.getElementsByTagName("td"),f=0,i=l.length;i>f;f++)if(l[f]==e)return[f,n];return null}function v(e,t){if(x=t,"undefined"==typeof e&&(e={}),"undefined"==typeof e.focus&&(e.focus=[0,0]),"undefined"==typeof e.table?e.table=jQuery("table.KeyTable")[0]:$(e.table).addClass("KeyTable"),"undefined"!=typeof e.focusClass&&(Q=e.focusClass),"undefined"!=typeof e.datatable&&(k=e.datatable),"undefined"==typeof e.initScroll&&(e.initScroll=!0),"undefined"==typeof e.form&&(e.form=!1),T=e.form,S=e.table.getElementsByTagName("tbody")[0],T){var n=document.createElement("div");D=document.createElement("input"),n.style.height="1px",n.style.width="0px",n.style.overflow="hidden","undefined"!=typeof e.tabIndex&&(D.tabIndex=e.tabIndex),n.appendChild(D),e.table.parentNode.insertBefore(n,e.table.nextSibling),jQuery(D).focus(function(){C||(E=!0,C=!1,"undefined"!=typeof e.focus.nodeName?f(e.focus,e.initScroll):f(y(e.focus[0],e.focus[1]),e.initScroll),setTimeout(function(){D.blur()},0))}),E=!1}else"undefined"!=typeof e.focus.nodeName?f(e.focus,e.initScroll):f(y(e.focus[0],e.focus[1]),e.initScroll),c();jQuery.browser.mozilla||jQuery.browser.opera?jQuery(document).bind("keypress",s):jQuery(document).bind("keydown",s),k?jQuery("tbody td",k.fnSettings().nTable).live("click",u):jQuery("td",S).live("click",u),jQuery(document).click(function(t){for(var n=t.target,o=!1;n;){if(n==e.table){o=!0;break}n=n.parentNode}o||i()})}this.block=!1,this.event={remove:{}},this.fnGetCurrentPosition=function(){return[j,L]},this.fnGetCurrentData=function(){return N.innerHTML},this.fnGetCurrentTD=function(){return N},this.fnSetPosition=function(e,t){"object"==typeof e&&e.nodeName?f(e):f(y(e,t))};var T,D,S=null,N=null,j=null,L=null,x=null,Q="focus",E=!1,_={action:[],esc:[],focus:[],blur:[]},k=null,C=!1;for(var w in _)w&&(this.event[w]=t(w),this.event.remove[w]=n(w));v(e,this)}